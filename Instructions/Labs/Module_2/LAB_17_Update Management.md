---
lab:
    title: '랩 17 - Azure Automation을 사용하여 Windows 업데이트 관리'
    module: '모듈 2 - 플랫폼 보호 구현'
---

# 모듈 2: 랩 17 - Azure Automation을 사용하여 Windows 업데이트 관리


**시나리오**

업데이트 관리 솔루션을 사용하여 가상 머신용 업데이트 및 패치를 관리할 수 있습니다. 이 자습서에서는 사용 가능한 업데이트의 상태를 빠르게 평가하고, 필수 업데이트 설치를 예약하고, 배포 결과를 검토하고, 업데이트가 정상 적용되는지를 확인하기 위한 경고를 생성하는 방법을 알아봅니다.

## 연습 1: Azure Automation을 사용하여 Windows 업데이트 관리

### 태스크 1: 리소스 그룹 만들기

1.  Azure 허브 메뉴의 **리소스 그룹**을 클릭합니다.

1.  **추가**를 클릭합니다.
1.  리소스 그룹 이름을 **RunBooks**로 지정합니다.
1.  지역을 **EastUS**로 변경합니다.

### 태스크 2: Automation 계정 만들기

1.  Azure 왼쪽 위의 **리소스 만들기**를 클릭합니다.

1.  **관리 도구**, **Automation**을 차례로 선택합니다.

1.  다음 정보를 입력합니다.

     |이름|리소스 그룹| 위치 | Azure 실행 계정 만들기
     |--------|--------|--------|--------|
     |MyAutomation|RunBooks|EastUS|예

1.  만들기를 클릭합니다.

1.  배포가 완료되면 **모든 서비스**를 클릭하고 **Automation 계정**을 선택한 다음 앞에서 만든 Automation 계정을 선택합니다.

### 태스크 3: 사용할 VM 만들기

1.  **가상 머신**을 클릭합니다.

1.  **추가**를 클릭합니다.

1.  다음 세부 정보를 입력하여 VM을 만듭니다.


     |리소스 그룹|가상 머신 이름|지역|이미지|사용자 이름|암호|
     |--------|--------|------|-------------------|-----------|------------|
     |RunBooks|UpdateVM|EastUS|Windows Server 2016|localadmin|Pa55w.rd1234|


1.  **검토 + 만들기**를 클릭합니다.

1.  **만들기**를 클릭합니다.

**참고:** 계속하기 전에 VM이 배포될 때까지 기다립니다.


### 태스크 4: 업데이트 관리를 사용하도록 설정

1.  Portal에서 가상 머신을 클릭합니다.

1.  이전 단계에서 만든 VM을 선택합니다.

1.  **작업**에서 **업데이트 관리**를 클릭합니다.

1.  **사용**을 클릭합니다.

 유효성 검사가 수행되어 이 VM에 대해 업데이트 관리가 사용하도록 설정되어 있는지를 확인합니다. 이 유효성 검사에서는 Azure Log Analytics 작업 영역 및 연결된 Automation 계정을 확인하며, 작업 영역에 업데이트 관리 솔루션이 있는지도 확인합니다.

 Log Analytics 작업 영역은 업데이트 관리 등의 기능/서비스에서 생성되는 데이터를 수집하는 데 사용됩니다. 이 작업 영역을 통해 여러 원본의 데이터를 한 곳에서 검토하고 분석할 수 있습니다.

 유효성 검사 프로세스에서는 VM에 Microsoft Monitoring Agent(MMA) 및 Automation Hybrid Runbook Worker가 프로비전되어 있는지도 확인합니다. 이 에이전트는 Azure Automation과 통신하고 업데이트 상태 관련 정보를 가져오는 데 사용됩니다. 에이전트가 Azure Automation 서비스와 통신하고 업데이트를 다운로드하려면 포트 443이 열려 있어야 합니다.

 온보딩 중에 다음 필수 구성 요소 중 누락된 요소가 발견되면 자동으로 추가됩니다.

  - **Log Analytics 작업 영역**
  - **Automation 계정**
  - **VM에서 사용하도록 설정된 A Hybrid Runbook Worker**
<br>

**참고**: 솔루션을 사용하도록 설정하려면 몇 분 정도 걸릴 수 있습니다. 이 시간 동안에는 브라우저 창을 닫지 마세요. 솔루션이 사용하도록 설정되면 VM의 누락된 업데이트 관련 정보가 Azure Monitor 로그로 전송됩니다. 분석에 데이터를 사용할 수 있게 될 때까지는 30분~6시간이 걸릴 수 있습니다.


### 태스크 5: 업데이트 평가 확인

1.  업데이트 관리를 사용하도록 설정하고 나면 **업데이트 관리** 창이 열립니다.

1.  이 창에 누락된 업데이트(있는 경우)가 표시됩니다.

    **참고**: 이전 단계에서 VM을 만든 경우, Microsoft에서 제공하는 이 템플릿 VM에 최신 Windows 업데이트가 모두 포함되어 있으므로 VM용 필수 업데이트가 표시되지 않을 수도 있습니다.


1.  사용 가능한 업데이트는 정보 링크 열 아래에 링크와 함께 표시됩니다. 따라서 해당 업데이트의 세부 정보를 확인하고 링크를 클릭하여 Microsoft에서 제공하는 업데이트 기술 자료 문서로 이동할 수 있습니다.

### 태스크 6: 경고 구성

1.  앞에서 만든 리소스 그룹으로 돌아옵니다.

1.  **MyAutomation** Automation 계정을 선택합니다.

1.  **모니터링** 아래에서 **경고**를 클릭합니다. 

1.  **새 경고 규칙**을 클릭합니다.

1.  **조건 추가**를 클릭합니다.

1.  목록에서 **총 업데이트 배포 실행 횟수**를 선택합니다.

1.  **Runbook 이름** 및 **상태** 옆의 **선택** 확인란을 클릭합니다.

1.  **경고 논리** 아래의 **임계값**에 **1**을 입력합니다.

1.  완료를 클릭합니다. 

1.  **경고 세부 정보**에서 **경고 규칙 이름**에 **UpdateAlert**를 입력합니다.

1.  심각도를 **Sev2**로 설정합니다.

1.  **작업 그룹**에서 **새로 만들기**를 선택합니다.

1.  다음 세부 정보를 입력합니다. 

     |작업 그룹 이름| 짧은 이름|리소스 그룹| 작업 이름|작업 유형|
     |------------------|-----------|--------------|------------|-----------|
     |VM 업데이트 작업 그룹|VMup|Runbooks|이메일|이메일/SMS/푸시/음성


1.  이메일 옆의 **세부 정보 편집**을 클릭하고 경고용으로 사용할 **이메일**을 입력합니다.

1.  **확인**을 클릭합니다.

1.  작업 그룹 아래의 **기존 항목 선택**을 클릭합니다.

1.  작업 그룹을 선택합니다.

1.  **만들기**를 클릭합니다. 

### 태스크 7: 업데이트 배포 예약

1.  VM 목록으로 돌아옵니다.

1.  랩 앞부분에서 만든 VM을 선택합니다.

1.  업데이트 관리를 클릭합니다.

1.  업데이트 배포 예약을 선택합니다.

1.  새로 예약된 업데이트 배포에서 다음 설정의 값을 입력합니다.

      - **이름** - ScheduledUpdates 
      - **일정 설정** -  되풀이 > 되풀이

1.  **확인**, **만들기**를 차례로 클릭합니다.

1.  **배포 일정**을 클릭하여 활성 **배포 일정** 목록을 확인합니다.

### 태스크 8: 업데이트 배포 결과 확인


**참고**: 예약된 배포가 시작되면 업데이트 배포 탭의 업데이트 관리 아래에서 해당 배포의 상태를 확인할 수 있습니다. 배포가 현재 실행 중이면 상태는 진행 중으로 표시됩니다. 배포가 정상적으로 완료되면 상태가 성공으로 변경됩니다. 배포의 업데이트 하나 이상이 실패하면 상태는 부분적으로 실패함으로 표시됩니다.


| 경고: 계속하기 전에 이 랩에서 사용한 모든 리소스를 제거해야 합니다.  **Azure Portal**에서 리소스를 제거하려면 **리소스 그룹**을 클릭합니다.  랩에서 만든 리소스 그룹을 모두 선택합니다.  리소스 그룹 블레이드에서 **리소스 그룹 삭제**를 클릭하고 리소스 그룹 이름을 입력한 다음 **삭제**를 클릭합니다.  추가로 만든 리소스 그룹이 있으면 이 프로세스를 반복합니다. **리소스 그룹을 삭제하지 않으면 다른 랩에서 문제가 발생할 수 있습니다.** |
| --- |


**결과**: Azure에서 Windows Server를 실행하는 VM용 경고 시스템을 사용하여 예약된 Windows 업데이트 관리 추가를 완료했습니다.

