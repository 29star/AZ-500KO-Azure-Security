---
lab:
    title: '랩 3 - 이벤트 허브'
    module: '모듈 3: 보안 작업 관리'
---

# 모듈 3: 랩 3 - 이벤트 허브


전송 및 수신 애플리케이션을 Event Hubs와 연결하면 데이터 손실 없이도 로드를 매우 많이 처리할 수 있습니다.

이 랩에서는 다음 작업을 수행합니다.

- Azure Portal을 사용하여 이벤트 허브 만들기
- 이벤트 허브를 통해 메시지를 보내거나 받도록 애플리케이션 구성
- Azure Portal을 사용하여 이벤트 허브 성능 평가

## 연습 1: 이벤트 허브 구현

### 태스크 1: 이벤트 허브 네임스페이스를 사용하도록 설정

1.  Azure Portal에 로그인합니다.

2.  검색 창에 **Event Hubs** 를 입력하고 **Event Hubs** 를 선택합니다.

3.  **추가** 를 클릭하여 새 Event Hubs 네임스페이스를 추가합니다.

  - 필드에 다음 세부 정보를 입력합니다.

     - **이름**: 고유한 이름
     - **가격 책정 계층**: 표준
     - **구독**: 사용자의 구독
     - **리소스 그룹**: 이름이 "EventHubRG"인 리소스 그룹 새로 만들기
     - **위치**: 미국 동부
     - **처리량 단위**: 2

4.  **만들기** 를 클릭합니다.

### 태스크 2: 나중에 사용할 스토리지 계정 만들기


**참고**: 나중에 Event Hubs로 전송되는 이벤트를 저장할 Blob 저장소 컨테이너와 스토리지 계정도 만들어야 합니다.


1.  검색 창에서 **스토리지 계정** 을 검색한 다음 **스토리지 계정** 을 클릭합니다.

2.  **추가** 를 클릭합니다.
3.  리소스 그룹 **EventHubsRG** 를 선택하거나, 다른 이름을 사용하도록 선택한 경우 리소스 그룹의 이름을 선택합니다.
4.  다음 옵션을 설정합니다.

      - **스토리지 계정 이름**: 고유한 이름(Azure 전체에서 고유해야 함)
      - **위치**: 미국 동부
      - **성능**: 표준
      - **계정 종류**: 범용 v2
      - **복제**: LRS(로컬 중복 스토리지)
      - **액세스 계층**: 핫

5.  **검토 + 만들기**, **만들기** 를 차례로 클릭합니다.

6.  스토리지 계정이 **생성** 될 때까지 기다립니다.
7.  스토리지 계정으로 돌아옵니다.
8.  생성한 스토리지 계정을 선택합니다.
9.  개요 창에서 **Blob** 를 클릭합니다.
10.  **+컨테이너** 를 클릭합니다.
11.  이름으로 **events** 를 입력합니다.
12.  **컨테이너의 공용 액세스 수준** 을 설정합니다.
13.  확인을 클릭합니다.

### 태스크 3: 새 이벤트 허브 만들기

1.  Event Hubs로 돌아와 새로 만든 이벤트 허브 네임스페이스의 이름을 클릭합니다.

2.  이벤트 허브 네임스페이스에서 선택 창의 엔터티 아래에서 **Event Hubs** 를 클릭합니다.

3.  **+이벤트 허브** 를 클릭합니다.

4.  이름으로 "events"을 입력합니다.

5.  **캡처** 아래에서 **켜기** 를 클릭합니다.

    **참고**: 이렇게 하면 앞에서 만든 Blob 저장소에 이벤트를 덤프하는 기능이 설정됩니다.


6.  **컨테이너 선택** 을 클릭합니다.

7.  **앞에서 만든 스토리지 계정 이름** 을 선택합니다.

8.  **앞에서 만든 Blob Storage 이름** 을 선택합니다.

9.  **선택** 을 클릭합니다.

10.  **만들기** 를 클릭합니다.

### 태스크 4: Event Hubs로 이벤트를 전송할 수 있도록 데이터 수집

1.  Event Hubs 네임스페이스에서 **공유 액세스 정책** 을 클릭합니다.

2.  **RootManageSharedAccessKey** 를 클릭합니다.

3.  기본 키 옆의 클립보드로 복사 아이콘을 클릭합니다.

4.  메모장을 열고 나중에 사용할 수 있도록 키를 붙여넣습니다. 

5.  Event Hubs 네임스페이스의 이름과 앞에서 만든 이벤트 허브의 이름을 같은 메모장 문서에 복사합니다.

**참고**: 이 기본 키와 기타 정보는 Event Hubs 시스템에 데이터를 입력하기 위해 나중에 실행할 스크립트에서 필요합니다.


### 태스크 5: 스크립트 파일 다운로드


이제 이벤트 허브로 전송하려는 이벤트를 작성하는 데 사용할 스크립트를 다운로드합니다. 이 스크립트는 Event Hubs와의 통신을 위해 작성된 환경의 애플리케이션 또는 Azure Event Hubs와 통신하는 다른 시스템에서 데이터를 수신하는 이벤트 허브가 시뮬레이션됩니다. 이 스크립트 파일은 godeploy에서 개발하여 PowerShell 갤러리에 게시한 것입니다.


1.  PowerShell 아이콘을 마우스 오른쪽 단추로 클릭하고 관리자 권한으로 **PowerShell** 을 연 후에 다음 명령을 실행합니다.

     ```powershell
    install-script get-blobevents, send-blobevents
     ```

**참고**: 메시지가 표시되면 설치를 확인합니다. 스크립트 파일이 다운로드되었으며 PowerShell에서 사용할 수 있습니다


### 태스크 6: 이벤트 허브에 메시지 전송


이 섹션에서는 이전 단계를 수행할 대 Portal포털에서 복사한 기본 키가 필요합니다.


1.  PowerShell을 엽니다.

2.  다음 명령을 실행합니다. 

     ```powershell
    send-blobevents
     ```

3.  이 명령을 실행하면 다음 데이터를 입력하라는 메시지가 표시됩니다.

      - **primaryKey**:        랩 앞부분에서 복사한 기본 키
      - **eventhubnamespace**: 네임스페이스의 이름
      - **eventhub**:          이벤트 허브의 이름
      - **numberOfEvents**:    10. 더 큰 값을 선택할 수도 있지만, 그러면 이벤트 허브로 이벤트를 전송하는 데 시간이 오래 걸립니다.
  

스크립트에서 **401 권한이 없음** 오류가 계속 발생하면 코드를 실행한 컴퓨터의 시계를 확인하세요. godeploy를 사용 중이라면 시계가 UTC로 설정되어 있어야 합니다. 시간을 수정한 경우 PowerShell 셸을 다시 시작하고 코드를 다시 실행해야 합니다.


**참고**: 이렇게 하면 일련의 이벤트가 임의 데이터와 함께 이벤트 허브로 전송됩니다.


### 태스크 7: 이벤트 허브 및 Blob Storage의 이벤트 검토

1.  Event Hubs의 **Event Hubs 네임스페이스** 로 돌아옵니다.

2.  **Event Hubs** 를 클릭하고 사용자의 **이벤트 허브** 를 선택합니다.

3.  개요 창에서 이벤트 허브 그래프를 검토하여 들어오는 메시지의 데이터 양이 급증했음을 확인합니다.

4.  **스토리지 계정** 을 검색하여 엽니다.

5.  사용자의 **Event Hubs 스토리지 계정** 을 선택합니다.

6.  **Blob** 을 클릭합니다.

7.  이벤트 저장용 **Blob 컨테이너** 를 엽니다.

**정보**: 이 컨테이너에서는 Event Hubs 시스템에서 생성한 원시 .avro 이벤트를 검토할 수 있습니다. Eveht Hubs에서 사용하는 .avro 형식에 대한 자세한 내용은 Wiki 문서 **`https://en.wikipedia.org/wiki/Apache_Avro`** 를 참조하세요.


### 태스크 8: REST 쿼리에서 Blob Storage로 전송되는 이벤트 검토

1.  **PowerShell** 을 시작합니다.

2.  **get-blobevents** 를 실행하고 메시지가 표시되면 다음 정보를 입력합니다.

  - **blobName**: 스토리지 계정의 이름
  - **containterName**: 이벤트가 저장되는 Blob 컨테이너의 이름
</br>

**참고**: 이 정보는 스토리지 계정에서 확인할 수 있습니다. 스크립트는 Blob Storage를 대상으로 REST 쿼리를 수행하여 스토리지 Blob에 있는 모든 .avro 이벤트의 목록을 표시합니다.

| 경고: 계속하기 전에 이 랩에서 사용한 모든 리소스를 제거해야 합니다.  **Azure Portal** 에서 리소스를 제거하려면 **리소스 그룹** 을 클릭합니다.  랩에서 만든 리소스 그룹을 모두 선택합니다.  리소스 그룹 블레이드에서 **리소스 그룹 삭제** 를 클릭하고 리소스 그룹 이름을 입력한 다음 **삭제** 를 클릭합니다.  추가로 만든 리소스 그룹이 있으면 이 프로세스를 반복합니다. **리소스 그룹을 삭제하지 않으면 다른 랩에서 문제가 발생할 수 있습니다.** |
| --- |


**결과**: 이 랩이 완료되었으며, 시리즈의 다음 랩을 진행할 수 있습니다.

